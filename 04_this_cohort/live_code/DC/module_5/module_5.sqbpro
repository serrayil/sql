<?xml version="1.0" encoding="UTF-8"?><sqlb_project><db path="/Users/serra/Desktop/DSI_assignments/sql/05_src/sql/farmersmarket.db" readonly="0" foreign_keys="1" case_sensitive_like="0" temp_store="0" wal_autocheckpoint="1000" synchronous="2"/><attached/><window><main_tabs open="structure browser pragmas query" current="3"/></window><tab_structure><column_width id="0" width="300"/><column_width id="1" width="0"/><column_width id="2" width="100"/><column_width id="3" width="7306"/><column_width id="4" width="0"/><expanded_item id="0" parent="1"/><expanded_item id="1" parent="1"/><expanded_item id="2" parent="1"/><expanded_item id="3" parent="1"/><expanded_item id="4" parent="1"/></tab_structure><tab_browse><table title="vendor_daily_sales" custom_title="0" dock_id="2" table="4,18:mainvendor_daily_sales"/><dock_state state="000000ff00000000fd00000001000000020000048a000002edfc0100000002fb000000160064006f0063006b00420072006f00770073006500310100000000ffffffff0000000000000000fb000000160064006f0063006b00420072006f007700730065003201000000000000048a0000011700ffffff0000048a0000000000000004000000040000000800000008fc00000000"/><default_encoding codec=""/><browse_table_settings><table schema="main" name="booth" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_" freeze_columns="0"><sort/><column_widths><column index="1" value="104"/><column index="2" value="125"/><column index="3" value="300"/><column index="4" value="83"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="vendor_daily_sales" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_" freeze_columns="0"><sort/><column_widths><column index="1" value="91"/><column index="2" value="85"/><column index="3" value="95"/><column index="4" value="91"/><column index="5" value="96"/><column index="6" value="59"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table></browse_table_settings></tab_browse><tab_sql><sql name="SQL 2">/* MODULE 5 */
/* INSERT UPDATE DELETE */


DROP TABLE IF EXISTS temp.product_expanded;
CREATE TEMP TABLE product_expanded AS
	SELECT * FROM product;
	
--SELECT * FROM product_expanded

/* 1. add a product to the temp table */
-- INSERT
INSERT INTO product_expanded
VALUES(24,'Almonds','1 lb', 3, 'lbs');



/* 2. change the product_size for THAT product */
--update 


/* 3. delete the newly added product */</sql><sql name="SQL 7">/* MODULE 5 */
/* VIEW */

/* 1. Create a vendor daily sales view */
DROP VIEW IF EXISTS vendor_daily_sales;
CREATE VIEW IF NOT EXISTS vendor_daily_sales AS
	SELECT 
	md.market_date
	,market_day
	,market_week
	,market_year
	,vendor_name 
	,SUM(quantity*cost_to_customer_per_qty) as sales
	
	
	FROM market_date_info md
	INNER JOIN customer_purchases cp
		ON md.market_date = cp.market_date
	INNER JOIN vendor v
		ON cp.vendor_id = v.vendor_id
		
	GROUP BY cp.market_date, v.vendor_id;

SELECT * FROM vendor_daily_sales
</sql><sql name="SQL 10">/* MODULE 5 */
/* VIEW in another query */

/* 1. Transform the daily sales view into a sales by vendor per week result */

SELECT 
market_year
,market_week
,vendor_name
,SUM(sales)


FROM vendor_daily_sales

GROUP BY 
market_year
,market_week
,vendor_name



</sql><sql name="SQL 9">/* MODULE 5 */
/* UPDATE statements for view */

/* 1. SET market_date equal to today for new_customer_purchases */
UPDATE new_customer_purchases
SET market_date = DATE('now');



/* 2. Add today's info to the market_date_info 

we need to add 
1. today's date
2. today's day
3. today's week number
4. today's year

INSERT INTO market_date_info
VALUES('....','....','....','....','8:00 AM','2:00 PM','nothing interesting','Summer','25','28',0,0);

*/
 INSERT INTO market_date_info
VALUES('2025-11-11','Tuesday','46','2025','8:00 AM','2:00 PM','nothing interesting','Winter','0','3',0,1)



</sql><sql name="SQL 8">/* MODULE 5 */
/* DYNAMIC VIEW */

DROP VIEW IF EXISTS todays_vendor_daily_sales;
CREATE VIEW IF NOT EXISTS todays_vendor_daily_sales AS 

	SELECT 
	md.market_date
	,market_day
	,market_week
	,market_year
	,vendor_name 
	,SUM(quantity*cost_to_customer_per_qty) as sales
	
	
	FROM market_date_info md
	INNER JOIN 
		(SELECT * FROM  customer_purchases 
		UNION
		SELECT * FROM new_customer_purchases
		) cp
		ON md.market_date = cp.market_date
	INNER JOIN vendor v
		ON cp.vendor_id = v.vendor_id
		
	WHERE md.market_date = DATE('now','localtime') -- if the timezone not set

	GROUP BY cp.market_date, v.vendor_id




ORDER BY s1.quantity DESC, s2.quantity
	







/* spoilers below */

















-- THIS ONLY WORKS IF YOU HAVE DONE THE PROPER STEPS FOR IMPORTING 
-- 1) update new_customer_purchases to today
-- 2) add the union 
-- 3) add the where statement
-- 4) update the market_date_info to include today




</sql><sql name="SQL 11">/* MODULE 5 */
/* CROSS  JOIN */


/* 1. CROSS JOIN sizes with product*/

DROP TABLE IF EXISTS TEMP.sizes;
CREATE TEMP TABLE IF NOT EXISTS TEMP.sizes (size TEXT);

INSERT INTO TEMP.sizes
VALUES('small'),
('medium'),
('large');

SELECT * FROM TEMP.sizes;

SELECT product_name, product_qty_type, size
FROM product
CROSS JOIN temp.sizes
WHERE product_qty_type = 'unit'

</sql><sql name="SQL 12">/* MODULE 5 */
/* SELF JOIN */

/* 1. Create a self-joining hierarchy */

DROP TABLE IF EXISTS TEMP.employees;
CREATE TEMP TABLE TEMP.employees 
(
emp_id INT
,emp_name text
,mgr_id INT
);

INSERT INTO TEMP.employees
VALUES(1,'Thomas',3)
,(2,'Niyaz', 4)
,(3,'Rohan', NULL)
,(4, 'Jennie',3);

SELECT * FROM TEMP.employees;




</sql><current_tab id="6"/></tab_sql></sqlb_project>
